<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
  <title>Document</title>
</head>
<body>
  <h3>role</h3>
  <div id="selectRole">
    <input type="radio" id="rolePolite" name="role" value="polite">
    <label for="rolePolite">polite</label>
    <input type="radio" id="roleImpolite" name="role" value="impolite">
    <label for="roleImpolite">impolite</label>
  </div>

  <h3>scan</h3>
  <video id="cameraVideo" width="400" height="300"></video>
  <canvas id="qrOutput"></canvas>
  <div id="qrcodeOut"></div>

  <script type="module">
    import QRSignaler from './QRSignaler.js'
    import RTCEngine from 'https://jspm.dev/rtc-engine'

    async function startConnection (role) {
      document.querySelector('#rolePolite').disabled = true
      document.querySelector('#roleImpolite').disabled = true

      const signaler = new QRSignaler({
        videoElem: document.querySelector('#cameraVideo'),
        canvasElem: document.querySelector('#qrOutput'),
        role
      })
      signaler.start()
      .then(() => {
        const engine = new RTCEngine(signaler)
      })
    }

    document.querySelector('#rolePolite').addEventListener('click', () => startConnection('polite'), { once: true })
    document.querySelector('#roleImpolite').addEventListener('click', () => startConnection('impolite'), { once: true })
  </script>
</body>
</html>